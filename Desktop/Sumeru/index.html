<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Siddhartha: The Journey</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

    <!-- Import Map for React & Modules -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.263.1",
            "@google/generative-ai": "https://esm.sh/@google/generative-ai"
        }
    }
    </script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Base Font Settings */
        body {
            font-family: system-ui, -apple-system, sans-serif;
        }
        .font-serif {
            font-family: 'Playfair Display', serif;
        }
        .font-mono {
            font-family: 'Space Mono', monospace;
        }
        
        /* Custom Animations */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes grain {
            0%, 100% { transform: translate(0, 0); }
            10% { transform: translate(-5%, -10%); }
            20% { transform: translate(-15%, 5%); }
            30% { transform: translate(7%, -25%); }
            40% { transform: translate(-5%, 25%); }
            50% { transform: translate(-15%, 10%); }
            60% { transform: translate(15%, 0%); }
            70% { transform: translate(0%, 15%); }
            80% { transform: translate(3%, 35%); }
            90% { transform: translate(-10%, 10%); }
        }
        @keyframes pulse-soft {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 0.4; }
        }
        @keyframes equalize {
            0%, 100% { height: 4px; }
            50% { height: 12px; }
        }
        
        .animate-float { animation: float 6s ease-in-out infinite; }
        .animate-fade-in-up { animation: fadeInUp 1s ease-out forwards; }
        .animate-fade-in { animation: fadeIn 1s ease-out forwards; }
        .animate-pulse-soft { animation: pulse-soft 3s infinite; }
        
        .animate-eq-1 { animation: equalize 1s ease-in-out infinite; }
        .animate-eq-2 { animation: equalize 1.2s ease-in-out infinite; animation-delay: 0.2s; }
        .animate-eq-3 { animation: equalize 0.8s ease-in-out infinite; animation-delay: 0.4s; }
        
        /* Grain Texture */
        .bg-grain-pattern {
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.3'/%3E%3C/svg%3E");
            mix-blend-mode: multiply;
        }
        .animate-grain {
            animation: grain 8s steps(10) infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { BookOpen, Feather, Waves, Coins, Eye, ArrowDown, RefreshCcw, Sparkles, Send, Loader2, Volume2, VolumeX, Globe } from 'lucide-react';
        import { GoogleGenerativeAI } from "@google/generative-ai";

        // --- Gemini API Setup ---
        // æ³¨æ„ï¼šè¦åœ¨æœ¬åœ°è¿è¡Œ AI åŠŸèƒ½ï¼Œè¯·åœ¨ä¸‹æ–¹å¡«å…¥æ‚¨çš„ API Key
        // æ‚¨å¯ä»¥åœ¨ https://aistudio.google.com/app/apikey èŽ·å–å…è´¹ Key
        const apiKey = "AIzaSyDnUL3k8iPMzfzj6K4E5CEf0wBMaDT0oak"; // ðŸŸ¢ åœ¨è¿™é‡Œå¡«å…¥ä½ çš„ Google Gemini API Key (ä¿ç•™å¼•å·)
        
        const genAI = new GoogleGenerativeAI(apiKey);
        const model = genAI.getGenerativeModel({ model: "gemini-2.5-flash-preview-09-2025" });

        const generateContent = async (prompt) => {
            if (!apiKey) {
                console.warn("No API Key provided. Returning mock response.");
                // å¦‚æžœæ²¡æœ‰ API Keyï¼Œè¿”å›žé»˜è®¤æç¤º
                return "The river is silent today. (API Key Missing) / æ²³æµä»Šæ—¥é™é»˜ï¼ˆç¼ºå°‘ API Keyï¼‰ã€‚";
            }
            try {
                const result = await model.generateContent(prompt);
                return result.response.text();
            } catch (error) {
                console.error("Gemini Error:", error);
                return "The river is silent today. Listen to your own heart.";
            }
        };

        // --- Data & Content ---
        const CONTENT = {
            en: {
                hero: {
                    title: "Siddhartha",
                    author: "Hermann Hesse",
                    quote: "One must find the source within one's own Self, one must possess it. Everything else was seeking -- a detour, an error.",
                    action: "Begin Journey"
                },
                stages: [
                    {
                        id: 'brahmin',
                        title: "The Brahmin's Son",
                        icon: BookOpen,
                        quote: "He had begun to suspect that his worthy father and his other teachers... had already poured the sum total of their knowledge into his waiting vessel.",
                        interaction: {
                            full: "Knowledge",
                            empty: "Empty",
                            instruction_full: "Tap the vessel to empty the mind.",
                            instruction_empty: "The vessel is empty. The journey begins."
                        },
                        theme: {
                            bg: "bg-gradient-to-br from-amber-100 via-orange-100 to-yellow-100",
                            text: "text-amber-900",
                            accent: "text-amber-600",
                            border: "border-amber-300",
                            interactive: "bg-amber-500"
                        }
                    },
                    {
                        id: 'samana',
                        title: "The Samanas",
                        icon: Feather,
                        quote: "I can think. I can wait. I can fast.",
                        interaction: {
                            wait: "Wait",
                            ascended: "Ascended",
                            instruction: "Hold to learn patience",
                            completed: "Spirit liberated. Moving on..."
                        },
                        theme: {
                            bg: "bg-gradient-to-br from-stone-100 via-emerald-50 to-green-100",
                            text: "text-emerald-900",
                            accent: "text-emerald-700",
                            border: "border-emerald-300",
                            interactive: "text-emerald-800"
                        }
                    },
                    {
                        id: 'samsara',
                        title: "Samsara",
                        icon: Coins,
                        quote: "The bird in the golden cage sang, and then it died. The game was finished.",
                        interaction: {
                            accumulate: "Accumulate",
                            break: "Break Cycle",
                            free: "The bird is free.",
                            calls: "THE RIVER CALLS..."
                        },
                        theme: {
                            bg: "bg-gradient-to-br from-rose-100 via-fuchsia-50 to-pink-100",
                            text: "text-rose-950",
                            accent: "text-rose-600",
                            border: "border-rose-300",
                            interactive: "bg-rose-500"
                        }
                    },
                    {
                        id: 'river',
                        title: "The River",
                        icon: Waves,
                        quote: "The river has many voices, but they are all one. Water flows, yet it is always here.",
                        interaction: {
                            voices: ["Sorrow", "Joy", "Greed"],
                            ask: "Ask the River",
                            cast: "Cast another thought",
                            placeholder: "e.g., Why do I suffer? What is time?",
                            label: "What seeks an answer?",
                            cancel: "Cancel"
                        },
                        theme: {
                            bg: "bg-gradient-to-br from-cyan-50 via-blue-100 to-sky-200",
                            text: "text-blue-950",
                            accent: "text-blue-600",
                            border: "border-blue-300",
                            interactive: "text-blue-600"
                        }
                    },
                    {
                        id: 'govinda',
                        title: "Govinda's Vision",
                        icon: Eye,
                        quote: "This stone is stone; it is also animal, god, and Buddha.",
                        interaction: {
                            unity: "Everything is one.",
                            test: "Test the unity.",
                            placeholder: "e.g., A cup, My hand, A leaf",
                            observe: "Observe Another",
                            return: "Return to Source"
                        },
                        theme: {
                            bg: "bg-gradient-to-br from-indigo-50 via-violet-100 to-purple-200",
                            text: "text-indigo-950",
                            accent: "text-indigo-600",
                            border: "border-indigo-300",
                            interactive: "text-indigo-600"
                        }
                    }
                ],
                footer: {
                    quote: "The river is everywhere."
                }
            },
            zh: {
                hero: {
                    title: "æ‚‰è¾¾å¤š",
                    author: "èµ«å°”æ›¼Â·é»‘å¡ž",
                    quote: "å¿…é¡»åœ¨è‡ªæˆ‘ä¹‹ä¸­æ‰¾åˆ°æºæ³‰å¹¶æ‹¥æœ‰å®ƒã€‚å…¶ä»–éƒ½æ˜¯å¯»è§…â€”â€”å¼¯è·¯ä¸Žé”™è¯¯ã€‚",
                    action: "å¼€å§‹æ—…ç¨‹"
                },
                stages: [
                    {
                        id: 'brahmin',
                        title: "å©†ç½—é—¨ä¹‹å­",
                        icon: BookOpen,
                        quote: "ä»–å¼€å§‹æ€€ç–‘ï¼Œå€¼å¾—å°Šæ•¬çš„çˆ¶äº²å’Œå…¶ä»–æ•™å¸ˆâ€¦â€¦æ—©å·²æŠŠä»–ä»¬å…¨éƒ¨çš„çŸ¥è¯†çŒå…¥äº†ä»–ç­‰å¾…çš„å™¨çš¿ã€‚",
                        interaction: {
                            full: "çŸ¥è¯†",
                            empty: "ç©º",
                            instruction_full: "ç‚¹å‡»å™¨çš¿ä»¥æ¸…ç©ºæ‚å¿µã€‚",
                            instruction_empty: "å™¨çš¿å·²ç©ºã€‚æ—…ç¨‹å¼€å§‹ã€‚"
                        },
                        theme: {
                            bg: "bg-gradient-to-br from-amber-100 via-orange-100 to-yellow-100",
                            text: "text-amber-900",
                            accent: "text-amber-600",
                            border: "border-amber-300",
                            interactive: "bg-amber-500"
                        }
                    },
                    {
                        id: 'samana',
                        title: "æ²™é—¨",
                        icon: Feather,
                        quote: "æˆ‘ä¼šæ€è€ƒã€‚æˆ‘ä¼šç­‰å¾…ã€‚æˆ‘ä¼šç¦é£Ÿã€‚",
                        interaction: {
                            wait: "ç­‰å¾…",
                            ascended: "è¶…è„±",
                            instruction: "æŒ‰ä½ä»¥å­¦ä¹ å¿è€",
                            completed: "çµé­‚å·²å¾—è§£è„±ã€‚ç»§ç»­å‰è¡Œ..."
                        },
                        theme: {
                            bg: "bg-gradient-to-br from-stone-100 via-emerald-50 to-green-100",
                            text: "text-emerald-900",
                            accent: "text-emerald-700",
                            border: "border-emerald-300",
                            interactive: "text-emerald-800"
                        }
                    },
                    {
                        id: 'samsara',
                        title: "è½®å›ž",
                        icon: Coins,
                        quote: "é‡‘ç¬¼ä¸­çš„é¸Ÿå”±æ­Œï¼Œç„¶åŽæ­»åŽ»ã€‚æ¸¸æˆç»“æŸäº†ã€‚",
                        interaction: {
                            accumulate: "ç§¯ç´¯",
                            break: "æ‰“ç ´è½®å›ž",
                            free: "é¸Ÿå„¿è‡ªç”±äº†ã€‚",
                            calls: "æ²³æµåœ¨å‘¼å”¤..."
                        },
                        theme: {
                            bg: "bg-gradient-to-br from-rose-100 via-fuchsia-50 to-pink-100",
                            text: "text-rose-950",
                            accent: "text-rose-600",
                            border: "border-rose-300",
                            interactive: "bg-rose-500"
                        }
                    },
                    {
                        id: 'river',
                        title: "æ²³æµ",
                        icon: Waves,
                        quote: "æ²³æœ‰ä¸‡åƒå£°éŸ³ï¼Œå´åŒä¸ºä¸€ã€‚æ°´åœ¨æµï¼Œå´æ°¸è¿œåœ¨æ­¤ã€‚",
                        interaction: {
                            voices: ["æ‚²ä¼¤", "å–œæ‚¦", "è´ªå©ª"],
                            ask: "å‘æ²³æµå‘é—®",
                            cast: "å†æ¬¡æŠ•å°„æ€ç»ª",
                            placeholder: "ä¾‹å¦‚ï¼šæˆ‘ä¸ºä½•å—è‹¦ï¼Ÿæ—¶é—´æ˜¯ä»€ä¹ˆï¼Ÿ",
                            label: "ä»€ä¹ˆåœ¨å¯»æ±‚ç­”æ¡ˆï¼Ÿ",
                            cancel: "å–æ¶ˆ"
                        },
                        theme: {
                            bg: "bg-gradient-to-br from-cyan-50 via-blue-100 to-sky-200",
                            text: "text-blue-950",
                            accent: "text-blue-600",
                            border: "border-blue-300",
                            interactive: "text-blue-600"
                        }
                    },
                    {
                        id: 'govinda',
                        title: "æˆˆæ–‡è¾¾çš„å¼‚è±¡",
                        icon: Eye,
                        quote: "è¿™å—çŸ³å¤´æ˜¯çŸ³å¤´ï¼Œä¹Ÿæ˜¯åŠ¨ç‰©ã€ç¥žä¸Žä½›ã€‚",
                        interaction: {
                            unity: "ä¸‡ç‰©å½’ä¸€ã€‚",
                            test: "éªŒè¯åŒä¸€æ€§ã€‚",
                            placeholder: "ä¾‹å¦‚ï¼šèŒ¶æ¯ï¼Œæˆ‘çš„æ‰‹ï¼Œä¸€ç‰‡å¶å­",
                            observe: "è§‚å¯Ÿä¸‡ç‰©",
                            return: "å›žåˆ°æºå¤´"
                        },
                        theme: {
                            bg: "bg-gradient-to-br from-indigo-50 via-violet-100 to-purple-200",
                            text: "text-indigo-950",
                            accent: "text-indigo-600",
                            border: "border-indigo-300",
                            interactive: "text-indigo-600"
                        }
                    }
                ],
                footer: {
                    quote: "æ²³æµæ— å¤„ä¸åœ¨ã€‚"
                }
            }
        };

        // --- Components ---

        const ScrollIndicator = () => (
            <div className="absolute bottom-8 left-1/2 -translate-x-1/2 animate-bounce opacity-70">
                <ArrowDown className="w-8 h-8 text-amber-900/50" />
            </div>
        );

        const ProgressBar = ({ scrollY }) => {
            const [height, setHeight] = useState(0);

            useEffect(() => {
                const totalHeight = document.documentElement.scrollHeight - window.innerHeight;
                setHeight((scrollY / totalHeight) * 100);
            }, [scrollY]);

            return (
                <div className="fixed left-0 top-0 h-1.5 bg-black/5 z-50 w-full pointer-events-none backdrop-blur-sm">
                    <div 
                        className="h-full bg-gradient-to-r from-amber-500 via-red-500 to-indigo-600 transition-all duration-100 ease-out shadow-[0_0_10px_rgba(245,158,11,0.5)]"
                        style={{ width: `${height}%` }}
                    />
                </div>
            );
        };

        const BackgroundAudio = () => {
            const [isPlaying, setIsPlaying] = useState(false);
            const audioRef = useRef(null);

            const togglePlay = async () => {
                if (audioRef.current) {
                    if (isPlaying) {
                        audioRef.current.pause();
                        setIsPlaying(false);
                    } else {
                        try {
                            audioRef.current.volume = 0.4; 
                            await audioRef.current.play();
                            setIsPlaying(true);
                        } catch (e) {
                            console.error("Audio play failed:", e);
                            setIsPlaying(false);
                        }
                    }
                }
            };

            return (
                <div className="fixed top-6 right-6 z-50 flex gap-3">
                    <audio
                        ref={audioRef}
                        loop
                        src="https://cdn.pixabay.com/audio/2022/05/27/audio_1808fbf07a.mp3"
                        preload="auto"
                    />
                    <button
                        onClick={togglePlay}
                        className="group relative flex items-center justify-center w-12 h-12 bg-white rounded-full border border-gray-200 text-black hover:bg-gray-100 transition-all duration-300 shadow-lg cursor-pointer"
                        title={isPlaying ? "Pause Music" : "Play Meditation Music"}
                    >
                        {isPlaying ? (
                            <div className="relative flex items-center justify-center">
                                <Volume2 size={20} className="text-black opacity-90" />
                                <div className="absolute -top-1 -right-2 flex gap-0.5 items-end h-3">
                                    <div className="w-0.5 bg-black animate-eq-1" />
                                    <div className="w-0.5 bg-black animate-eq-2" />
                                    <div className="w-0.5 bg-black animate-eq-3" />
                                </div>
                            </div>
                        ) : (
                            <VolumeX size={20} className="text-black opacity-60" />
                        )}
                    </button>
                </div>
            );
        };

        const LanguageToggle = ({ lang, setLang }) => {
            return (
                <button
                    onClick={() => setLang(prev => prev === 'en' ? 'zh' : 'en')}
                    className="fixed top-6 right-20 z-50 group flex items-center justify-center h-12 px-4 bg-white rounded-full text-black hover:bg-gray-100 transition-all duration-300 shadow-lg cursor-pointer font-serif border border-gray-200"
                    title="Switch Language"
                >
                    <Globe size={18} className="mr-2 opacity-80" />
                    <span className="text-sm font-medium tracking-wider">{lang === 'en' ? 'EN' : 'ä¸­'}</span>
                </button>
            );
        };

        // --- Interactive Stage Components ---

        const BrahminInteraction = ({ theme, onComplete, content }) => {
            const [fullness, setFullness] = useState(100);
            
            const handlePour = () => {
                if (fullness <= 0) return;
                const nextLevel = Math.max(0, fullness - 20);
                setFullness(nextLevel);
                
                if (nextLevel === 0 && onComplete) {
                    onComplete();
                }
            };

            return (
                <div className="flex flex-col items-center gap-6">
                    <div 
                        className={`relative w-32 h-40 border-4 ${theme.border} rounded-b-3xl overflow-hidden cursor-pointer transition-transform active:scale-95 shadow-xl bg-white/50`}
                        onClick={handlePour}
                    >
                        <div 
                            className={`absolute bottom-0 left-0 w-full transition-all duration-700 ease-in-out ${theme.interactive} opacity-80`}
                            style={{ height: `${fullness}%` }}
                        />
                        {fullness > 0 && (
                            <div className="absolute inset-0 w-full h-full opacity-30 pointer-events-none animate-pulse-soft bg-gradient-to-t from-black/10 to-transparent" />
                        )}
                        
                        <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
                            <span className={`text-xs font-bold uppercase tracking-widest ${theme.text} mix-blend-overlay`}>
                                {fullness > 0 ? content.full : content.empty}
                            </span>
                        </div>
                    </div>
                    <p className={`text-sm font-serif italic ${theme.accent} font-medium`}>
                        {fullness === 0 ? content.instruction_empty : content.instruction_full}
                    </p>
                </div>
            );
        };

        const SamanaInteraction = ({ theme, onComplete, content }) => {
            const [progress, setProgress] = useState(0);
            const [isHolding, setIsHolding] = useState(false);
            const intervalRef = useRef(null);
            const completedRef = useRef(false);

            const startWaiting = () => setIsHolding(true);
            const stopWaiting = () => setIsHolding(false);

            useEffect(() => {
                if (isHolding && progress < 100) {
                    intervalRef.current = setInterval(() => {
                        setProgress(p => {
                            const next = Math.min(100, p + 1);
                            return next;
                        });
                    }, 50);
                } else {
                    clearInterval(intervalRef.current);
                }
                return () => clearInterval(intervalRef.current);
            }, [isHolding, progress]);

            useEffect(() => {
                if (progress === 100 && !completedRef.current) {
                    completedRef.current = true;
                    if (onComplete) {
                        onComplete();
                    }
                }
            }, [progress, onComplete]);

            return (
                <div className="flex flex-col items-center gap-4">
                    <button 
                        className={`w-28 h-28 rounded-full border-4 ${theme.border} flex items-center justify-center transition-all duration-500 bg-white/80 backdrop-blur-sm ${isHolding ? 'scale-110 shadow-2xl border-emerald-500' : 'scale-100 shadow-md'}`}
                        onMouseDown={startWaiting}
                        onMouseUp={stopWaiting}
                        onMouseLeave={stopWaiting}
                        onTouchStart={startWaiting}
                        onTouchEnd={stopWaiting}
                        disabled={progress === 100}
                    >
                        <span className={`text-sm font-bold font-mono select-none ${theme.interactive}`}>
                            {progress === 100 ? content.ascended : content.wait}
                        </span>
                    </button>
                    
                    <div className="w-64 h-2 bg-stone-300/50 rounded-full overflow-hidden">
                        <div 
                            className="h-full bg-emerald-600 transition-all duration-75 ease-linear"
                            style={{ width: `${progress}%` }}
                        />
                    </div>
                    
                    <p className={`text-xs ${theme.text} font-mono opacity-80`}>
                        {progress === 100 ? content.completed : content.instruction}
                    </p>
                </div>
            );
        };

        const SamsaraInteraction = ({ theme, onComplete, content }) => {
            const [wealth, setWealth] = useState(0);
            const [broken, setBroken] = useState(false);
            const [isFadingOut, setIsFadingOut] = useState(false);

            const accumulate = () => {
                if (!broken) setWealth(w => w + 1);
            };

            const breakCycle = () => {
                setIsFadingOut(true);
                setTimeout(() => {
                    setBroken(true);
                    setWealth(0);
                    if (onComplete) {
                        onComplete();
                    }
                }, 500);
            };

            if (broken) {
                return (
                    <div className="flex flex-col items-center justify-center w-full h-full animate-fade-in text-center">
                        <Feather className="w-16 h-16 text-rose-400 mb-6 animate-float" />
                        <p className={`font-serif italic text-xl ${theme.text}`}>{content.free}</p>
                        <p className="text-sm text-rose-400 mt-4 animate-pulse-soft tracking-widest font-mono">{content.calls}</p>
                    </div>
                );
            }

            return (
                <div 
                    className={`flex flex-col items-center gap-8 w-full h-full justify-center transition-opacity duration-500 ${isFadingOut ? 'opacity-0' : 'opacity-100'}`}
                >
                    <div className="grid grid-cols-5 gap-3 w-56 h-56 content-center justify-items-center bg-rose-500/5 rounded-full p-4 shrink-0">
                        {[...Array(Math.min(wealth, 25))].map((_, i) => (
                            <div key={i} className="w-6 h-6 rounded-full bg-gradient-to-br from-yellow-300 to-yellow-500 border border-yellow-600 shadow-sm animate-fade-in transform hover:scale-110 transition-transform" />
                        ))}
                    </div>

                    <div className="flex justify-center gap-4">
                        <button 
                            onClick={accumulate}
                            className={`px-6 py-2 bg-gradient-to-r from-rose-600 to-fuchsia-600 text-white font-bold font-sans text-xs uppercase tracking-wider rounded-full shadow-md hover:shadow-rose-500/30 hover:scale-105 active:scale-95 transition-all`}
                        >
                            {content.accumulate}
                        </button>
                        {wealth > 5 && (
                            <button 
                                onClick={breakCycle}
                                className={`px-6 py-2 border-2 ${theme.border} ${theme.text} font-bold font-sans text-xs uppercase tracking-wider rounded-full hover:bg-white/50 transition-all`}
                            >
                                {content.break}
                            </button>
                        )}
                    </div>
                </div>
            );
        };

        const RiverInteraction = ({ theme, content, lang, onComplete }) => {
            const [mode, setMode] = useState('listen');
            const [query, setQuery] = useState('');
            const [response, setResponse] = useState('');
            const [isLoading, setIsLoading] = useState(false);

            const handleAskRiver = async (e) => {
                e.preventDefault();
                if (!query.trim()) return;

                setIsLoading(true);
                const prompt = `
                    Roleplay as the River from Hermann Hesse's Siddhartha.
                    Language: ${lang === 'zh' ? 'Chinese (Simplified)' : 'English'}.
                    A seeker has cast this thought into the water: "${query}".
                    
                    Respond with deep, fluid, non-dualistic wisdom. Speak of the unity of all things, the illusion of time, or the merging of voices. 
                    Keep it brief (under 35 words/characters), poetic, and soothing. 
                    End with 'Om' (or 'å”µ').
                `;

                const text = await generateContent(prompt);
                setResponse(text);
                setIsLoading(false);

                if (onComplete) {
                    setTimeout(() => {
                        onComplete();
                    }, 3000);
                }
            };

            const reset = () => {
                setMode('listen');
                setResponse('');
                setQuery('');
            };

            const activateAskMode = (e) => {
                e.stopPropagation();
                setMode('ask');
            };

            return (
                <div className="w-full max-w-md">
                    {mode === 'listen' ? (
                        <div 
                            className="relative h-48 flex items-center justify-center cursor-pointer group bg-gradient-to-b from-blue-500/10 to-cyan-500/10 rounded-3xl border border-white/40 shadow-inner overflow-hidden"
                            onClick={activateAskMode}
                        >
                            <div className="absolute inset-0 opacity-30">
                                <div className="absolute top-[-50%] left-[-50%] w-[200%] h-[200%] bg-[radial-gradient(circle,rgba(56,189,248,0.4)_0%,transparent_50%)] animate-[spin_10s_linear_infinite]" />
                            </div>
                            
                            <div className="absolute inset-0 flex items-center justify-center z-10">
                                <div className={`flex gap-8 ${theme.text} font-serif italic text-xl select-none opacity-60`}>
                                    {content.voices.map((voice, i) => (
                                        <span key={i} className="animate-float" style={{ animationDelay: `${i * 0.2}s` }}>{voice}</span>
                                    ))}
                                </div>
                            </div>
                            
                            <div className="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-500 z-20 bg-white/20 backdrop-blur-sm">
                                <div className="bg-white px-6 py-3 rounded-full text-blue-600 font-bold font-sans text-sm flex items-center gap-2 shadow-xl transform group-hover:scale-105 transition-transform">
                                    <Sparkles size={16} className="text-cyan-500" /> {content.ask}
                                </div>
                            </div>
                        </div>
                    ) : (
                        <div className="animate-fade-in-up p-6 min-h-[192px] flex flex-col justify-center bg-white/60 backdrop-blur-md rounded-2xl border border-white/50 shadow-xl">
                            {response ? (
                                <div className="text-center space-y-6">
                                    <p className={`font-serif italic text-xl ${theme.text} leading-relaxed`}>"{response}"</p>
                                    <button 
                                        onClick={reset}
                                        className={`text-xs font-bold uppercase tracking-widest ${theme.accent} hover:opacity-70`}
                                    >
                                        {content.cast}
                                    </button>
                                </div>
                            ) : (
                                <form onSubmit={handleAskRiver} className="flex flex-col gap-4">
                                    <label className={`text-sm font-bold uppercase tracking-widest ${theme.accent} text-center opacity-70`}>
                                        {content.label}
                                    </label>
                                    <div className="relative group">
                                        <input 
                                            type="text"
                                            value={query}
                                            onChange={(e) => setQuery(e.target.value)}
                                            placeholder={content.placeholder}
                                            className="w-full bg-white border-2 border-blue-100 rounded-xl px-4 py-4 text-blue-900 font-serif focus:outline-none focus:border-blue-400 transition-colors pr-12 shadow-sm group-hover:shadow-md"
                                            disabled={isLoading}
                                        />
                                        <button 
                                            type="submit"
                                            disabled={isLoading || !query}
                                            className="absolute right-3 top-1/2 -translate-y-1/2 text-blue-300 hover:text-blue-600 disabled:opacity-30 transition-colors"
                                        >
                                            {isLoading ? <Loader2 className="animate-spin" size={24} /> : <Send size={24} />}
                                        </button>
                                    </div>
                                    <button 
                                        type="button" 
                                        onClick={reset}
                                        className="text-xs text-center text-blue-400 hover:text-blue-600 mt-2 font-bold uppercase tracking-wider"
                                    >
                                        {content.cancel}
                                    </button>
                                </form>
                            )}
                        </div>
                    )}
                </div>
            );
        };

        const GovindaInteraction = ({ theme, onReset, content, lang }) => {
            const [inputObj, setInputObj] = useState('');
            const [vision, setVision] = useState('');
            const [isLoading, setIsLoading] = useState(false);

            const handleVision = async (e) => {
                e.preventDefault();
                if (!inputObj.trim()) return;

                setIsLoading(true);
                const prompt = `
                    In the style of Hermann Hesse's Siddhartha (final chapter).
                    Language: ${lang === 'zh' ? 'Chinese (Simplified)' : 'English'}.
                    Explain how "${inputObj}" is not just an object, but contains all things, all time, god and buddha. 
                    Be profound but concise (max 40 words). 
                    Start with "${lang === 'zh' ? 'è¿™' : 'This'} ${inputObj}...".
                `;

                const text = await generateContent(prompt);
                setVision(text);
                setIsLoading(false);
            };

            return (
                <div className="text-center animate-fade-in-up w-full max-w-sm mx-auto">
                    {!vision ? (
                        <>
                            <p className={`font-serif italic text-3xl ${theme.text} mb-3`}>{content.unity}</p>
                            <p className={`${theme.accent} text-sm mb-8 font-medium uppercase tracking-widest opacity-70`}>{content.test}</p>
                            
                            <form onSubmit={handleVision} className="relative mb-10 group">
                                <input 
                                    type="text"
                                    value={inputObj}
                                    onChange={(e) => setInputObj(e.target.value)}
                                    placeholder={content.placeholder}
                                    className={`w-full text-center bg-transparent border-b-2 ${theme.border} py-3 font-serif text-2xl ${theme.text} placeholder:text-indigo-200/60 focus:outline-none focus:border-indigo-500 transition-colors`}
                                />
                                <button 
                                    type="submit"
                                    disabled={isLoading || !inputObj}
                                    className="absolute right-0 bottom-3 text-indigo-300 hover:text-indigo-600 disabled:opacity-0 transition-all transform hover:scale-110"
                                >
                                    {isLoading ? <Loader2 className="animate-spin" size={24} /> : <Sparkles size={24} />}
                                </button>
                            </form>
                        </>
                    ) : (
                        <div className="mb-10 animate-fade-in relative">
                            <div className="absolute inset-0 bg-gradient-to-r from-red-500 via-green-500 to-blue-500 opacity-10 blur-xl rounded-full animate-pulse-soft" />
                            
                            <div className="relative z-10 p-8 bg-white/70 backdrop-blur-xl rounded-2xl border border-white/60 shadow-2xl">
                                <p className={`font-serif italic text-xl ${theme.text} leading-relaxed`}>
                                    {vision}
                                </p>
                            </div>
                            
                            <button 
                                onClick={() => { setVision(''); setInputObj(''); }}
                                className={`mt-8 text-xs font-bold ${theme.accent} hover:text-indigo-800 uppercase tracking-widest transition-colors`}
                            >
                                {content.observe}
                            </button>
                        </div>
                    )}

                    <div 
                        className="group flex flex-col items-center gap-3 cursor-pointer opacity-50 hover:opacity-100 transition-opacity mt-8"
                        onClick={onReset}
                    >
                        <div className="p-2 bg-white rounded-full shadow-md group-hover:shadow-lg transition-all">
                            <RefreshCcw className="text-indigo-900 group-hover:rotate-180 transition-transform duration-700" size={20} />
                        </div>
                        <span className="text-[10px] font-bold text-indigo-900 uppercase tracking-widest">{content.return}</span>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [scrollY, setScrollY] = useState(0);
            const [activeStage, setActiveStage] = useState(0);
            const [journeyId, setJourneyId] = useState(0);
            const [lang, setLang] = useState('zh'); // Default Chinese

            const currentContent = CONTENT[lang];

            useEffect(() => {
                const handleScroll = () => {
                    setScrollY(window.scrollY);
                    
                    const stages = document.querySelectorAll('.stage-section');
                    stages.forEach((stage, index) => {
                        const rect = stage.getBoundingClientRect();
                        if (rect.top < window.innerHeight / 2 && rect.bottom > window.innerHeight / 2) {
                            setActiveStage(index);
                        }
                    });
                };

                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            const scrollToStart = () => {
                document.getElementById('stage-0').scrollIntoView({ behavior: 'smooth' });
            };

            const handleResetJourney = () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
                setTimeout(() => {
                    setJourneyId(prev => prev + 1);
                }, 500);
            };

            const handleStageComplete = (index) => {
                setTimeout(() => {
                    const nextStage = document.getElementById(`stage-${index + 1}`);
                    if (nextStage) {
                        const rect = nextStage.getBoundingClientRect();
                        const isAlreadyViewed = rect.top < window.innerHeight / 2;
                        
                        if (!isAlreadyViewed) {
                            nextStage.scrollIntoView({ behavior: 'smooth', block: 'center' }); 
                        }
                    }
                }, 1500);
            };

            return (
                <div className="min-h-screen font-sans selection:bg-fuchsia-200 selection:text-fuchsia-900 overflow-x-hidden">
                    <ProgressBar scrollY={scrollY} />
                    <BackgroundAudio />
                    <LanguageToggle lang={lang} setLang={setLang} />

                    {/* Hero Section */}
                    <section className="relative h-screen flex flex-col items-center justify-center p-6 overflow-hidden bg-gradient-to-b from-orange-200 via-amber-300 to-yellow-200">
                        <div className="absolute inset-0 z-0 opacity-40 pointer-events-none">
                            <div className="absolute inset-0 bg-grain-pattern animate-grain" />
                        </div>
                        
                        <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[800px] bg-gradient-to-r from-orange-400/30 to-amber-500/30 rounded-full blur-3xl opacity-60 animate-pulse-soft" />
                        
                        <div className="z-10 text-center max-w-4xl mx-auto space-y-8 animate-fade-in-up relative">
                            <div className="text-amber-900/70 uppercase tracking-[0.5em] text-sm md:text-base font-bold mb-4 drop-shadow-sm">
                                {currentContent.hero.author}
                            </div>
                            <h1 className="text-8xl md:text-[10rem] font-serif text-amber-950 tracking-tighter leading-none mb-8 opacity-90 drop-shadow-lg mix-blend-color-burn">
                                {currentContent.hero.title}
                            </h1>
                            <p className="text-2xl md:text-3xl font-serif text-amber-900 italic leading-relaxed max-w-2xl mx-auto drop-shadow-sm opacity-90">
                                "{currentContent.hero.quote}"
                            </p>
                            <button 
                                onClick={scrollToStart}
                                className="group relative px-12 py-5 mt-16 overflow-hidden rounded-full border-2 border-amber-900/30 text-amber-950 font-bold font-sans tracking-[0.2em] uppercase transition-all hover:bg-amber-900 hover:text-amber-100 backdrop-blur-sm shadow-xl hover:shadow-2xl hover:-translate-y-1"
                            >
                                <span className="relative z-10">{currentContent.hero.action}</span>
                            </button>
                        </div>
                        
                        <ScrollIndicator />
                    </section>

                    {/* Stages */}
                    <main className="relative z-10">
                        {currentContent.stages.map((stageContent, index) => {
                            const isActive = activeStage === index;
                            const icons = {
                                'brahmin': BookOpen,
                                'samana': Feather,
                                'samsara': Coins,
                                'river': Waves,
                                'govinda': Eye
                            };
                            const Icon = icons[stageContent.id];

                            return (
                                <section 
                                    id={`stage-${index}`}
                                    key={`${stageContent.id}-${journeyId}`} 
                                    className={`stage-section min-h-screen flex flex-col items-center justify-center p-8 transition-all duration-1000 ${stageContent.theme.bg} relative overflow-hidden`}
                                >
                                    <div className="absolute inset-0 opacity-20 pointer-events-none mix-blend-overlay">
                                        <div className="absolute inset-0 bg-grain-pattern" />
                                    </div>

                                    <div className={`transition-all duration-1000 transform ${isActive ? 'opacity-100 translate-y-0 scale-100' : 'opacity-40 translate-y-20 scale-95 blur-sm'}`}>
                                        
                                        <div className={`mb-8 p-5 bg-white/60 backdrop-blur-xl rounded-full ${stageContent.theme.text} shadow-lg mx-auto w-fit`}>
                                            <Icon size={40} strokeWidth={1.5} />
                                        </div>
                                        
                                        <h2 className={`text-5xl md:text-7xl font-serif mb-8 text-center ${stageContent.theme.text} drop-shadow-sm`}>{stageContent.title}</h2>
                                        
                                        <div className={`w-24 h-1 ${stageContent.theme.interactive} mb-10 mx-auto rounded-full opacity-60`} />
                                        
                                        <p className={`text-xl md:text-2xl text-center font-serif leading-relaxed mb-16 max-w-2xl ${stageContent.theme.text} opacity-90 italic`}>
                                            "{stageContent.quote}"
                                        </p>

                                        <div className="w-full max-w-lg p-10 bg-white/40 backdrop-blur-md rounded-3xl border border-white/60 shadow-2xl transition-all duration-500 hover:bg-white/50 hover:shadow-3xl mx-auto h-[380px] flex items-center justify-center">
                                            <div className="w-full h-full flex flex-col items-center justify-center">
                                                {stageContent.id === 'brahmin' && <BrahminInteraction theme={stageContent.theme} content={stageContent.interaction} onComplete={() => handleStageComplete(index)} />}
                                                {stageContent.id === 'samana' && <SamanaInteraction theme={stageContent.theme} content={stageContent.interaction} onComplete={() => handleStageComplete(index)} />}
                                                {stageContent.id === 'samsara' && <SamsaraInteraction theme={stageContent.theme} content={stageContent.interaction} onComplete={() => handleStageComplete(index)} />}
                                                {stageContent.id === 'river' && <RiverInteraction theme={stageContent.theme} content={stageContent.interaction} lang={lang} onComplete={() => handleStageComplete(index)} />}
                                                {stageContent.id === 'govinda' && <GovindaInteraction theme={stageContent.theme} content={stageContent.interaction} lang={lang} onReset={handleResetJourney} />}
                                            </div>
                                        </div>
                                    </div>
                                </section>
                            );
                        })}
                    </main>

                    {/* Footer */}
                    <footer className="py-32 text-center bg-stone-950 text-stone-400 relative z-10 border-t border-stone-800">
                        <p className="font-serif italic text-2xl mb-8 opacity-60 hover:opacity-100 transition-opacity duration-700">"{currentContent.footer.quote}"</p>
                        <div className="flex justify-center gap-6 text-xs font-bold uppercase tracking-[0.2em] opacity-30">
                            <span>{currentContent.hero.author}</span>
                            <span>â€¢</span>
                            <span>1922</span>
                            <span>â€¢</span>
                            <a href="https://bond.sites.northeastern.edu" target="_blank" rel="noopener noreferrer" className="hover:text-stone-200 transition-colors">BBPM</a>
                        </div>
                    </footer>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
